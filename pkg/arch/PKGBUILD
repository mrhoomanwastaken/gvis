# Maintainer: mrhooman <113311405+mrhoomanwastaken@users.noreply.github.com>
pkgname=gvis
pkgver=0.2
pkgrel=1
pkgdesc="A music visualizer based on cavacore and built with Gtk+3"
arch=('x86_64' 'aarch64')
url="https://github.com/mrhoomanwastaken/gvis"
license=('GPL')
depends=('gtk3' 'mesa' 'dbus')
makedepends=('python' 'python-pip' 'git')
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/mrhoomanwastaken/gvis/archive/refs/tags/v${pkgver}.tar.gz")
sha256sums=('530c3075e50c9b07c708a07fbdd57ef9afece4412e05c979374947e962b6c0b0')  # Update this with actual checksum after first build

prepare() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    
    # Create blank .env file if it doesn't exist
    if [ ! -f .env ]; then
        touch .env
    fi
}

build() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    
    # Run make compile to build the binary
    make mkconfig
    make compile
}

package() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    
    # Install binary
    install -Dm755 nudist/gvis.bin "${pkgdir}/usr/bin/gvis"
    
    # Install desktop file
    install -Dm644 gvis.desktop "${pkgdir}/usr/share/applications/gvis.desktop"
    
    # Install license
    install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
